function generateCitySkyline(){const e=document.querySelector(".city-skyline");e&&e.remove();const t=document.createElement("div");t.className="city-skyline",document.body.appendChild(t);const n=window.innerWidth;let i=0,a=0;for(;i<n;){const e=createBuilding(i,n-i,a);t.appendChild(e),i+=e.offsetWidth+20*seededRandom(.2*a),a++}addWindowsToBuildings()}let sessionSeed,birdInterval,cleanupInterval;function seededRandom(e){const t=1e4*Math.sin(e+sessionSeed);return t-Math.floor(t)}function createBuilding(e,t,n){const i=document.createElement("div");i.className="building";const a=.1*n,s=60*seededRandom(a)+30;let d;const r=seededRandom(a+1);return d=r<.1?200*seededRandom(a+2)+300:r<.3?150*seededRandom(a+3)+200:r<.6?100*seededRandom(a+4)+120:80*seededRandom(a+5)+60,i.style.left=e+"px",i.style.width=s+"px",i.style.height=d+"px",i}function addWindowsToBuildings(){document.querySelectorAll(".building").forEach(((e,t)=>{const n=e.getBoundingClientRect(),i=n.width,a=(n.height,e.offsetHeight);a>300?addDenseWindows(e,i,a,t):a>200?addRegularWindows(e,i,a,t):addSparseWindows(e,i,a,t)}))}function addDenseWindows(e,t,n,i){const a=Math.floor(t/6),s=Math.floor(n/6);for(let t=2;t<s-2;t++)for(let n=1;n<a-1;n++){const a=100*i+10*t+n;seededRandom(a)>.2&&addWindow(e,6*n,6*t,3,a)}}function addRegularWindows(e,t,n,i){const a=Math.floor(t/8),s=Math.floor(n/8);for(let t=1;t<s-1;t++)for(let n=1;n<a-1;n++){const a=100*i+10*t+n;seededRandom(a)>.3&&addWindow(e,8*n,8*t,4,a)}}function addSparseWindows(e,t,n,i){const a=Math.floor(t/10),s=Math.floor(n/10);for(let t=1;t<s-1;t++)for(let n=1;n<a-1;n++){const a=100*i+10*t+n;seededRandom(a)>.5&&addWindow(e,10*n,10*t,4,a)}}function addWindow(e,t,n,i,a){const s=document.createElement("div");s.className="window",s.style.left=t+"px",s.style.top=n+"px",s.style.width=i+"px",s.style.height=i+"px";const d=seededRandom(a+1e3),r=seededRandom(a+2e3);d<.25&&(r<.4?s.classList.add("lit"):r<.7?s.classList.add("bright"):r<.85?s.classList.add("warm"):s.classList.add("cool")),e.appendChild(s)}(()=>{const e=e=>document.querySelector(e),t=e=>Array.from(document.querySelectorAll(e)),n=e("#canvas1"),i=e("#download-btn"),a=e("#new-upload"),s=e("#image-viewer-container"),d=e("#processing-placeholder"),r=e("#toggle-before"),o=e("#toggle-after"),l=e("#hero-upload"),c=e("#nav-upload"),m=e("#pricing-upload"),g=(e("#try-sample"),{original:"media/example/Original.png",modern:"media/example/Modern.png",scandinavian:"media/example/Scandinavian.png",luxury:"media/example/Luxury.png",coastal:"media/example/Coastal.png",midcentury:"media/example/Midcentury.png",farmhouse:"media/example/Farmhouse.png"});t(".hero-tabs .chip").forEach((n=>{n.addEventListener("click",(()=>{t(".hero-tabs .chip").forEach((e=>e.classList.remove("selected"))),n.classList.add("selected");const i=n.dataset.heroStyle,a=e("#hero-stage-img");if(a.className="hero-stage-img filtered "+i,i&&g[i]){a.src=g[i];const e=i.charAt(0).toUpperCase()+i.slice(1);a.alt=e+" staged apartment example"}}))}));e("#stage");const u=e("#stage-modal"),h=e("#modal-backdrop"),f=e("#modal-close"),p=e("#stage-dropzone"),v=e("#stage-file-input"),y=e("#stage-preview"),w=e("#process-btn"),L=e("#additional-prompt"),E=W("#room-type-select"),S=W("#furniture-style-select"),b=e("#progress"),I=e("#progress-bar"),B=e("#progress-text"),T=e("#loading-message"),x=e("#year");function C(){N()}x&&(x.textContent=(new Date).getFullYear()),u&&p&&v&&([l,c,m].forEach((e=>{e&&e.addEventListener("click",C)})),t(".thumb").forEach((t=>{t.addEventListener("click",(()=>{N();const n=t.getAttribute("data-src");y.src=n,y.classList.remove("hidden"),e(".stage-dz-inner").classList.add("hidden")}))})),["dragenter","dragover"].forEach((e=>{p.addEventListener(e,(e=>{e.preventDefault(),p.style.borderColor="#000"}))})),["dragleave","drop"].forEach((e=>{p.addEventListener(e,(e=>{e.preventDefault(),p.style.borderColor="#e8e8e8"}))})),p.addEventListener("click",(()=>{v.click()})),p.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),v.click())})),p.addEventListener("drop",(e=>{const t=e.dataTransfer.files?.[0];t&&R(t)})),v.addEventListener("change",(e=>{const t=e.target.files?.[0];t&&R(t)})));let M=null,k=!1;function R(e){if(!e.type.startsWith("image/"))return;M=e,k=!1;const t=new FileReader;t.onload=()=>{y.src=t.result,p.classList.add("hidden"),s.classList.remove("hidden"),d.style.display="none",n.classList.add("hidden"),A()},t.readAsDataURL(e)}function A(){y.classList.remove("hidden"),n.classList.add("hidden"),r.classList.add("active"),o.classList.remove("active"),y.src&&(d.style.display="none")}function D(){y.classList.add("hidden"),n.classList.remove("hidden"),r.classList.remove("active"),o.classList.add("active"),d.style.display=k?"none":"flex"}function N(){u.classList.remove("hidden")}function _(){u.classList.add("hidden")}function W(e){const t=document.querySelector(e);if(!t)return{get value(){return""}};const n=t.querySelector(".select-trigger"),i=t.querySelector(".select-menu"),a=t.querySelector(".select-value"),s=Array.from(t.querySelectorAll(".option"));function d(e){t.dataset.value=e,a.textContent=s.find((t=>t.dataset.value===e))?.textContent||e,s.forEach((t=>t.classList.toggle("selected",t.dataset.value===e))),i.classList.add("hidden")}return n.addEventListener("click",(()=>{i.classList.toggle("hidden")})),s.forEach((e=>{e.addEventListener("click",(()=>d(e.dataset.value)))})),document.addEventListener("click",(e=>{t.contains(e.target)||i.classList.add("hidden")})),{get value(){return t.dataset.value},set(e){d(e)}}}r&&r.addEventListener("click",A),o&&o.addEventListener("click",(()=>{D()})),w&&w.addEventListener("click",(async function(){if(M){w.disabled=!0;try{const e=await async function(e){b.classList.remove("hidden"),I.style.width="0%",B.textContent="Uploading image…",T.classList.remove("hidden"),T.textContent="Preparing AI model";const t=["Finding the perfect furniture for you","Staging your ideal room","Selecting beautiful decor pieces","Arranging furniture for maximum appeal","Creating the perfect ambiance","Enhancing your space with style","Designing your dream interior","Optimizing room layout and flow","Adding finishing touches","Bringing your vision to life"];let n,i=!1,a=0;const s=setInterval((()=>{a<15&&(a+=3*Math.random(),I.style.width=Math.min(a,15)+"%")}),200);try{const d=new FormData;d.append("image",e),d.append("roomType",E?.value||"Living room"),d.append("furnitureStyle",S?.value||"standard"),d.append("additionalPrompt",L?.value||""),await new Promise((e=>setTimeout(e,800))),clearInterval(s),a=25,I.style.width="25%",B.textContent="Preparing AI model…",setTimeout((()=>{i=!0,B.textContent="AI is staging your room…",n=setInterval((()=>{if(i){const e=t[Math.floor(Math.random()*t.length)];T.textContent=e}}),2e3);const e=t[Math.floor(Math.random()*t.length)];T.textContent=e}),1e3);const r=setInterval((()=>{a<70&&(a+=2*Math.random(),I.style.width=Math.min(a,70)+"%")}),300),o=await fetch("/api/process-image",{method:"POST",body:d});if(clearInterval(r),a=75,I.style.width="75%",B.textContent="AI is staging your room…",!o.ok){const e=await o.json();throw new Error(e.error||"Processing failed")}const l=setInterval((()=>{a<95&&(a+=3*Math.random(),I.style.width=Math.min(a,95)+"%")}),150),c=await o.json();if(clearInterval(l),clearInterval(n),i=!1,T.classList.add("hidden"),I.style.width="100%",B.textContent="Complete!",c.success&&c.image)return c.image;throw new Error("No image data received")}catch(e){throw clearInterval(s),clearInterval(n),i=!1,T.classList.add("hidden"),B.textContent="Error: "+e.message,I.style.width="0%",setTimeout((()=>{b.classList.add("hidden")}),3e3),e}}(M),t=new Image;t.onload=()=>{const e=n.getContext("2d"),i=t.width,a=t.height;e.canvas.width=i,e.canvas.height=a,e.drawImage(t,0,0,i,a),k=!0,d.style.display="none",D(),b.classList.add("hidden"),w.disabled=!1},t.src=e}catch(e){w.disabled=!1}}else alert("Please upload an image first")})),h&&h.addEventListener("click",_),f&&f.addEventListener("click",_),i&&i.addEventListener("click",(()=>{if(!n.width)return;const e=document.createElement("a");e.download="stagify-result.png",e.href=n.toDataURL("image/png"),e.click()})),a&&a.addEventListener("click",(()=>{if(M=null,k=!1,y.src="",p.classList.remove("hidden"),s.classList.add("hidden"),v.value="",b.classList.add("hidden"),d.style.display="flex",n){n.getContext("2d").clearRect(0,0,n.width,n.height),n.width=0,n.height=0}}))})(),sessionStorage.getItem("skylineSeed")?sessionSeed=parseFloat(sessionStorage.getItem("skylineSeed")):(sessionSeed=1e3*Math.random(),sessionStorage.setItem("skylineSeed",sessionSeed.toString())),document.addEventListener("DOMContentLoaded",(function(){generateCitySkyline(),window.addEventListener("resize",(function(){generateCitySkyline()})),startBirdAnimations(),init3DTiltEffect()}));let activeBirds=[];const MAX_BIRDS=3,CLEANUP_INTERVAL=3e4;function startBirdAnimations(){cleanup(),restoreBirdsFromStorage(),birdInterval=setInterval((()=>{activeBirds.length<MAX_BIRDS&&Math.random()>.6&&createBird()}),4e3),setTimeout((()=>{activeBirds.length<MAX_BIRDS&&createBird()}),6e3),cleanupInterval=setInterval(cleanupExpiredBirds,CLEANUP_INTERVAL),window.addEventListener("beforeunload",saveBirdsToStorage)}function cleanup(){birdInterval&&(clearInterval(birdInterval),birdInterval=null),cleanupInterval&&(clearInterval(cleanupInterval),cleanupInterval=null),window.removeEventListener("beforeunload",saveBirdsToStorage);document.querySelectorAll(".bird").forEach((e=>e.remove())),activeBirds=[]}function createBird(){const e="bird_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),t=document.createElement("div");t.className="bird",t.id=e;const n=document.createElement("img"),i=Math.random();n.src=`media/Bird.gif?t=${i}`,n.alt="Flying bird",t.appendChild(n);const a=Math.random()*(.6*window.innerHeight)+50;t.style.setProperty("--bird-y",a+"px");const s=Math.random()>.5?"left-to-right":"right-to-left";t.classList.add(s,"single"),document.body.appendChild(t);const d={id:e,y:a,direction:s,startTime:Date.now(),duration:15e3};activeBirds.push(d),setTimeout((()=>{t.parentNode&&t.parentNode.removeChild(t),activeBirds=activeBirds.filter((t=>t.id!==e))}),15e3)}function saveBirdsToStorage(){try{const e=Date.now(),t=activeBirds.filter((t=>{const n=e-t.startTime;return n<t.duration&&n>=0})).map((t=>({...t,remainingTime:t.duration-(e-t.startTime)})));t.length>0?sessionStorage.setItem("stagify_birds",JSON.stringify(t)):sessionStorage.removeItem("stagify_birds")}catch(e){sessionStorage.removeItem("stagify_birds")}}function cleanupExpiredBirds(){const e=Date.now();activeBirds.length;activeBirds=activeBirds.filter((t=>e-t.startTime<t.duration));document.querySelectorAll(".bird").forEach((e=>{activeBirds.some((t=>t.id===e.id))||e.remove()}));try{const t=sessionStorage.getItem("stagify_birds");if(t){const n=JSON.parse(t);0===n.filter((t=>t.remainingTime>0&&e-(t.startTime||0)<(t.duration||15e3))).length&&sessionStorage.removeItem("stagify_birds")}}catch(e){sessionStorage.removeItem("stagify_birds")}activeBirds.length}function restoreBirdsFromStorage(){const e=sessionStorage.getItem("stagify_birds");if(e)try{const t=JSON.parse(e);let n=0;t.forEach((e=>{e&&e.remainingTime>1e3&&e.remainingTime<=15e3&&n<MAX_BIRDS&&activeBirds.length<MAX_BIRDS&&(createRestoredBird(e),n++)})),sessionStorage.removeItem("stagify_birds")}catch(e){sessionStorage.removeItem("stagify_birds")}}function createRestoredBird(e){const t=document.createElement("div");t.className="bird",t.id=e.id;const n=document.createElement("img"),i=Math.random();n.src=`media/Bird.gif?t=${i}`,n.alt="Flying bird",t.appendChild(n),t.style.setProperty("--bird-y",e.y+"px"),t.classList.add(e.direction,"single");const a=15*-((e.duration-e.remainingTime)/e.duration);t.style.animationDelay=a+"s",document.body.appendChild(t);const s={...e,startTime:Date.now()-(e.duration-e.remainingTime)};activeBirds.push(s),setTimeout((()=>{t.parentNode&&t.parentNode.removeChild(t),activeBirds=activeBirds.filter((t=>t.id!==e.id))}),e.remainingTime)}function init3DTiltEffect(){applyTiltEffect(".advantages"),applyTiltEffect(".faq");document.querySelectorAll(".contact-card").forEach(((e,t)=>{applyTiltEffectToElement(e)}))}function applyTiltEffect(e){const t=document.querySelector(e);t&&applyTiltEffectToElement(t)}function applyTiltEffectToElement(e){let t=!1;e.addEventListener("mouseenter",(function(){t=!0})),e.addEventListener("mouseleave",(function(){t=!1,e.style.transform="rotateX(0deg) rotateY(0deg)"})),e.addEventListener("mousemove",(function(n){if(!t)return;const i=e.getBoundingClientRect(),a=i.left+i.width/2,s=i.top+i.height/2,d=n.clientX-a,r=n.clientY-s,o=d/(i.width/2)*8,l=-r/(i.height/2)*8;e.style.transform=`rotateX(${l}deg) rotateY(${o}deg)`}))}