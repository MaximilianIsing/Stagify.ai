(()=>{let e=e=>document.querySelector(e),t=e=>Array.from(document.querySelectorAll(e)),i=e("#canvas1"),a=e("#download-btn"),r=e("#new-upload"),n=e("#image-viewer-container"),l=e("#processing-placeholder"),d=e("#toggle-before"),s=e("#toggle-after"),o=e("#hero-upload"),c=e("#nav-upload"),m=e("#pricing-upload");e("#try-sample");let u={original:"media-webp/example/Original.webp",modern:"media-webp/example/Modern.webp",scandinavian:"media-webp/example/Scandinavian.webp",luxury:"media-webp/example/Luxury.webp",coastal:"media-webp/example/Coastal.webp",midcentury:"media-webp/example/Midcentury.webp",farmhouse:"media-webp/example/Farmhouse.webp"};t(".hero-tabs .chip").forEach(i=>{i.addEventListener("click",()=>{t(".hero-tabs .chip").forEach(e=>e.classList.remove("selected")),i.classList.add("selected");let a=i.dataset.heroStyle,r=e("#hero-stage-img");if(r.className="hero-stage-img filtered "+a,a&&u[a]){"original"===a||(r.loading="lazy"),r.src=u[a];let n=a.charAt(0).toUpperCase()+a.slice(1);r.alt=n+" staged apartment example"}})}),e("#stage");let p=e("#stage-modal"),g=e("#modal-backdrop"),f=e("#modal-close"),h=e("#stage-dropzone"),v=e("#stage-file-input"),y=e("#stage-preview"),E=e("#process-btn"),$=e("#additional-prompt"),L=O("#room-type-select"),b=O("#furniture-style-select"),w=e("#progress"),I=e("#progress-bar"),B=e("#progress-text"),S=e("#loading-message"),x=(e("#loading-ad-container"),e("#year"));function T(){D()}x&&(x.textContent=new Date().getFullYear()),p&&h&&v&&([o,c,m].forEach(e=>{e&&e.addEventListener("click",T)}),t(".thumb").forEach(t=>{t.addEventListener("click",()=>{D();let i=t.getAttribute("data-src");y.src=i,y.classList.remove("hidden"),e(".stage-dz-inner").classList.add("hidden")})}),["dragenter","dragover"].forEach(e=>{h.addEventListener(e,e=>{e.preventDefault(),h.style.borderColor="#000"})}),["dragleave","drop"].forEach(e=>{h.addEventListener(e,e=>{e.preventDefault(),h.style.borderColor="#e8e8e8"})}),h.addEventListener("click",()=>{v.click()}),h.addEventListener("keydown",e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),v.click())}),h.addEventListener("drop",e=>{let t=e.dataTransfer.files?.[0];t&&A(t)}),v.addEventListener("change",e=>{let t=e.target.files?.[0];t&&A(t)}));let C=null,k=!1;function A(e){if(!["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(e.type)){alert("Please upload a PNG, JPG, JPEG, WebP, or GIF image file.");return}if(e.size>104857600){alert("File is too large. Please upload an image smaller than 100MB.");return}C=e,k=!1;let t=new FileReader;t.onload=()=>{y.src=t.result,h.classList.add("hidden"),n.classList.remove("hidden"),l.style.display="none",i.classList.add("hidden"),P()},t.readAsDataURL(e)}async function R(e){w.classList.remove("hidden"),I.style.width="0%",B.textContent="Uploading image…",S.classList.remove("hidden"),S.textContent="Preparing AI model",P();let t=["Finding the perfect furniture for you","Staging your ideal room","Selecting beautiful decor pieces","Arranging furniture for maximum appeal","Creating the perfect ambiance","Enhancing your space with style","Designing your dream interior","Optimizing room layout and flow","Adding finishing touches","Bringing your vision to life"],i,a=!1,r=0,n=setInterval(()=>{r<15&&(r+=3*Math.random(),I.style.width=Math.min(r,15)+"%")},200);try{let d=new FormData;d.append("image",e),d.append("roomType",L?.value||"Living room"),d.append("furnitureStyle",b?.value||"standard"),d.append("additionalPrompt",$?.value||"");let s=document.getElementById("remove-furniture");d.append("removeFurniture",s?.checked||!1);let o=localStorage.getItem("userRole")||"unknown",c=localStorage.getItem("userReferralSource")||"",m=localStorage.getItem("userEmail")||"";d.append("userRole",o),d.append("userReferralSource",c),d.append("userEmail",m),await new Promise(e=>setTimeout(e,800)),clearInterval(n),r=25,I.style.width="25%",B.textContent="Preparing AI model…",setTimeout(()=>{a=!0,B.textContent="AI is staging your room…",i=setInterval(()=>{if(a){let e=t[Math.floor(Math.random()*t.length)];S.textContent=e}},2e3);let e=t[Math.floor(Math.random()*t.length)];S.textContent=e},1e3);let u=setInterval(()=>{r<70&&(r+=2*Math.random(),I.style.width=Math.min(r,70)+"%")},300),p=await fetch("/api/process-image",{method:"POST",body:d});if(clearInterval(u),r=75,I.style.width="75%",B.textContent="AI is staging your room…",!p.ok){let g=await p.json();if("FILE_TOO_LARGE"===g.code)throw Error("File is too large. Please upload an image smaller than 100MB.");if(500===p.status)throw Error("Bad prompt inputted");throw Error(g.message||g.error||"Processing failed")}let f=setInterval(()=>{r<95&&(r+=3*Math.random(),I.style.width=Math.min(r,95)+"%")},150),h=await p.json();if(clearInterval(f),clearInterval(i),a=!1,S.classList.add("hidden"),l&&!k&&(l.style.display="flex"),I.style.width="100%",B.textContent="Complete!",h.success&&h.image)return h.image;throw Error("No image data received")}catch(v){throw clearInterval(n),clearInterval(i),a=!1,S.classList.add("hidden"),l&&!k&&(l.style.display="flex"),B.textContent="Error: "+v.message,I.style.width="0%",setTimeout(()=>{w.classList.add("hidden")},3e3),v}}function _(){let e=b?.value||"standard";return e}function P(){y.classList.remove("hidden"),i.classList.add("hidden"),d.classList.add("active"),s.classList.remove("active"),y.src&&(l.style.display="none")}function F(){y.classList.add("hidden"),i.classList.remove("hidden"),d.classList.remove("active"),s.classList.add("active"),k?l.style.display="none":l.style.display="flex"}async function q(){if(!C){alert("Please upload an image first");return}E.disabled=!0;try{let e=await R(C),t=new Image;t.onload=()=>{let e=i.getContext("2d"),a=t.width,r=t.height;e.canvas.width=a,e.canvas.height=r,e.drawImage(t,0,0,a,r),k=!0,l.style.display="none",F(),w.classList.add("hidden"),E.disabled=!1},t.src=e}catch(a){E.disabled=!1}}function D(){p.classList.remove("hidden")}function N(){p.classList.add("hidden")}function O(e){let t=document.querySelector(e);if(!t)return{get value(){return""}};let i=t.querySelector(".select-trigger"),a=t.querySelector(".select-menu"),r=t.querySelector(".select-value"),n=Array.from(t.querySelectorAll(".option"));function l(e){t.dataset.value=e,r.textContent=n.find(t=>t.dataset.value===e)?.textContent||e,n.forEach(t=>t.classList.toggle("selected",t.dataset.value===e)),a.classList.add("hidden")}return i.addEventListener("click",()=>{a.classList.toggle("hidden")}),n.forEach(e=>{e.addEventListener("click",()=>l(e.dataset.value))}),document.addEventListener("click",e=>{t.contains(e.target)||a.classList.add("hidden")}),{get value(){return t.dataset.value},set(e){l(e)}}}d&&d.addEventListener("click",P),s&&s.addEventListener("click",()=>{F()}),E&&E.addEventListener("click",q),g&&g.addEventListener("click",N),f&&f.addEventListener("click",N),a&&a.addEventListener("click",()=>{if(!i.width)return;let e=document.createElement("a");e.download="stagify-result.png",e.href=i.toDataURL("image/png"),e.click()}),r&&r.addEventListener("click",()=>{if(C=null,k=!1,y.src="",h.classList.remove("hidden"),n.classList.add("hidden"),v.value="",w.classList.add("hidden"),l.style.display="flex",i){let e=i.getContext("2d");e.clearRect(0,0,i.width,i.height),i.width=0,i.height=0}})})(),document.addEventListener("DOMContentLoaded",function(){initRolePopup(),startBirdAnimations(),init3DTiltEffect()});let birdInterval,cleanupInterval,activeBirds=[];const MAX_BIRDS=3,CLEANUP_INTERVAL=3e4;function startBirdAnimations(){cleanup(),restoreBirdsFromStorage(),birdInterval=setInterval(()=>{activeBirds.length<3&&Math.random()>.6&&createBird()},4e3),setTimeout(()=>{activeBirds.length<3&&createBird()},6e3),cleanupInterval=setInterval(cleanupExpiredBirds,3e4),window.addEventListener("beforeunload",saveBirdsToStorage)}function cleanup(){birdInterval&&(clearInterval(birdInterval),birdInterval=null),cleanupInterval&&(clearInterval(cleanupInterval),cleanupInterval=null),window.removeEventListener("beforeunload",saveBirdsToStorage);let e=document.querySelectorAll(".bird");e.forEach(e=>e.remove()),activeBirds=[]}function createBird(){let e="bird_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),t=document.createElement("div");t.className="bird",t.id=e;let i=document.createElement("img");i.src=`media-webp/Bird.gif?t=${Math.random()}`,i.alt="Flying bird",t.appendChild(i);let a=Math.random()*(.6*window.innerHeight)+50;t.style.setProperty("--bird-y",a+"px");let r=Math.random()>.5?"left-to-right":"right-to-left";t.classList.add(r,"single"),document.body.appendChild(t);let n={id:e,y:a,direction:r,startTime:Date.now(),duration:15e3};activeBirds.push(n),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t),activeBirds=activeBirds.filter(t=>t.id!==e)},15e3)}function saveBirdsToStorage(){try{let e=Date.now(),t=activeBirds.filter(t=>{let i=e-t.startTime;return i<t.duration&&i>=0}).map(t=>({...t,remainingTime:t.duration-(e-t.startTime)}));t.length>0?sessionStorage.setItem("stagify_birds",JSON.stringify(t)):sessionStorage.removeItem("stagify_birds")}catch(i){sessionStorage.removeItem("stagify_birds")}}function cleanupExpiredBirds(){let e=Date.now();activeBirds.length,activeBirds=activeBirds.filter(t=>{let i=e-t.startTime;return i<t.duration});let t=document.querySelectorAll(".bird");t.forEach(e=>{let t=activeBirds.some(t=>t.id===e.id);t||e.remove()});try{let i=sessionStorage.getItem("stagify_birds");if(i){let a=JSON.parse(i),r=a.filter(t=>t.remainingTime>0&&e-(t.startTime||0)<(t.duration||15e3));0===r.length&&sessionStorage.removeItem("stagify_birds")}}catch(n){sessionStorage.removeItem("stagify_birds")}activeBirds.length}function restoreBirdsFromStorage(){let e=sessionStorage.getItem("stagify_birds");if(e)try{let t=JSON.parse(e),i=0;t.forEach(e=>{e&&e.remainingTime>1e3&&e.remainingTime<=15e3&&i<3&&activeBirds.length<3&&(createRestoredBird(e),i++)}),sessionStorage.removeItem("stagify_birds")}catch(a){sessionStorage.removeItem("stagify_birds")}}function createRestoredBird(e){let t=document.createElement("div");t.className="bird",t.id=e.id;let i=document.createElement("img");i.src=`media-webp/Bird.gif?t=${Math.random()}`,i.alt="Flying bird",t.appendChild(i),t.style.setProperty("--bird-y",e.y+"px"),t.classList.add(e.direction,"single");let a=(e.duration-e.remainingTime)/e.duration;t.style.animationDelay=-(15*a)+"s",document.body.appendChild(t);let r={...e,startTime:Date.now()-(e.duration-e.remainingTime)};activeBirds.push(r),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t),activeBirds=activeBirds.filter(t=>t.id!==e.id)},e.remainingTime)}function init3DTiltEffect(){applyTiltEffect(".advantages"),applyTiltEffect(".faq");let e=document.querySelectorAll(".contact-card");e.forEach((e,t)=>{applyTiltEffectToElement(e)})}function applyTiltEffect(e){let t=document.querySelector(e);t&&applyTiltEffectToElement(t)}function applyTiltEffectToElement(e){let t=!1;e.addEventListener("mouseenter",function(){t=!0}),e.addEventListener("mouseleave",function(){t=!1,e.style.transform="rotateX(0deg) rotateY(0deg)"}),e.addEventListener("mousemove",function(i){if(!t)return;let a=e.getBoundingClientRect(),r=a.left+a.width/2,n=a.top+a.height/2,l=i.clientX-r,d=i.clientY-n,s=l/(a.width/2)*8,o=-(8*(d/(a.height/2)));e.style.transform=`rotateX(${o}deg) rotateY(${s}deg)`})}function initRolePopup(){let e=localStorage.getItem("userInfoCompleted");e||setTimeout(()=>{showRolePopup()},1e3)}function showRolePopup(){let e=document.getElementById("role-popup");if(e){e.classList.remove("hidden");let t=e.querySelectorAll("[data-role]");t.forEach(e=>{e.addEventListener("click",function(){let e=this.getAttribute("data-role");handleRoleSelection(e)})})}}function handleRoleSelection(e){localStorage.setItem("userRole",e),localStorage.setItem("roleSelectedAt",new Date().toISOString()),showReferralPopup()}function showReferralPopup(){let e=document.getElementById("role-popup");e&&e.classList.add("hidden");let t=document.getElementById("referral-popup");if(t){t.classList.remove("hidden");let i=t.querySelectorAll("[data-referral]");i.forEach(e=>{e.addEventListener("click",function(){let e=this.getAttribute("data-referral");handleReferralSelection(e)})})}}function handleReferralSelection(e){localStorage.setItem("userReferralSource",e),localStorage.setItem("referralSelectedAt",new Date().toISOString()),showEmailPopup()}function showEmailPopup(){let e=document.getElementById("referral-popup");e&&e.classList.add("hidden");let t=document.getElementById("email-popup");if(t){t.classList.remove("hidden");let i=document.getElementById("skip-email");i&&i.addEventListener("click",function(){handleEmailSubmission("")});let a=document.getElementById("submit-email");if(a){a.addEventListener("click",function(){let e=document.getElementById("user-email"),t=e?e.value.trim():"";handleEmailSubmission(t)});let r=document.getElementById("user-email");r&&(r.addEventListener("input",function(){let e=this.value.trim(),t=e.includes("@")&&e.includes(".");a.disabled=!t}),a.disabled=!0)}let n=document.getElementById("user-email");n&&n.addEventListener("keypress",function(e){if("Enter"===e.key){let t=this.value.trim(),i=t.includes("@")&&t.includes(".");i&&handleEmailSubmission(t)}})}}function handleEmailSubmission(e){localStorage.setItem("userEmail",e),localStorage.setItem("emailSubmittedAt",new Date().toISOString()),localStorage.setItem("userInfoCompleted","true");let t=localStorage.getItem("userRole")||"",i=localStorage.getItem("userReferralSource")||"",a=navigator.userAgent;fetch("/api/log-contact",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userRole:t,referralSource:i,email:e,userAgent:a})}).then(e=>e.json()).then(e=>{e.success?console.log("Contact logged successfully"):console.error("Failed to log contact:",e.message)}).catch(e=>{console.error("Error logging contact:",e)});let r=document.getElementById("role-popup"),n=document.getElementById("referral-popup"),l=document.getElementById("email-popup");r&&r.classList.add("hidden"),n&&n.classList.add("hidden"),l&&l.classList.add("hidden"),customizeExperienceForRole(t)}function customizeExperienceForRole(e){document.body.setAttribute("data-user-role",e)}